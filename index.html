<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Basics of Scaffolding</title>
    <style>
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background-color: #f0f2f5; padding: 10px; margin: 0; touch-action: manipulation;
        }
        
        .header-area { text-align: center; margin: 15px 0; }
        h1 { color: #2c3e50; font-size: 1.6rem; margin: 0; }
        .author { color: #7f8c8d; font-size: 0.85rem; margin-top: 4px; }

        .controls-container { max-width: 600px; margin: 0 auto 20px; padding: 0 10px; }
        #searchInput {
            width: 100%; padding: 12px; border-radius: 25px; border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 1rem; outline: none; box-sizing: border-box;
            margin-bottom: 15px;
        }

        .category-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .category-scroll::-webkit-scrollbar { display: none; }
        .cat-tab {
            white-space: nowrap; padding: 8px 16px; background: #fff;
            border: 1px solid #ddd; border-radius: 20px; font-size: 0.85rem;
            cursor: pointer; transition: 0.2s;
        }
        .cat-tab.active { background: #2c3e50; color: white; border-color: #2c3e50; }

        .gallery {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 10px; max-width: 1200px; margin: 0 auto; padding-bottom: 30px;
        }
        .card {
            background: white; border-radius: 8px; overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; position: relative;
        }
        .thumb-container {
            width: 100%; height: 100px; background: #e9ecef;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .thumb-container img { width: 100%; height: 100%; object-fit: cover; }
        .video-indicator {
            position: absolute; top: 35px; left: 40px; background: rgba(0,0,0,0.7);
            color: white; border-radius: 50%; padding: 10px; font-size: 12px; z-index: 2;
        }
        .card-title { padding: 5px; font-size: 0.75rem; font-weight: bold; text-align: center; }

        /* --- MODAL --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; width: 95%; max-width: 600px; border-radius: 12px;
            max-height: 90vh; display: flex; flex-direction: column; position: relative;
            overflow: hidden;
        }

        /* Swipe/Nav Animation */
        .slide-effect { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-body-scroll { padding: 15px; overflow-y: auto; flex-grow: 1; }
        
        .nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.9); border: none; width: 35px; height: 35px;
            border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 10;
            display: flex; align-items: center; justify-content: center;
        }
        @media (max-width: 600px) { .nav-btn { display: none; } } /* Hide buttons on mobile to use swipe */
        
        .nav-prev { left: 8px; }
        .nav-next { right: 8px; }

        .item-counter {
            position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.5);
            color: white; padding: 2px 10px; border-radius: 12px; font-size: 0.75rem; z-index: 11;
        }

        .media-container { width: 100%; margin-bottom: 15px; background: #000; border-radius: 8px; overflow: hidden; }
        .media-container img { width: 100%; height: auto; display: block; margin: 0 auto; }
        .media-container video, .media-container iframe { width: 100%; aspect-ratio: 16 / 9; border: none; }

        .close-btn-top { position: absolute; top: 10px; right: 10px; color: #333; font-size: 28px; cursor: pointer; z-index: 11; background: rgba(255,255,255,0.8); border-radius: 50%; width: 32px; height: 32px; text-align: center; line-height: 30px; }
        .btn-close-bottom { display: block; width: 100%; padding: 12px; margin-top: 20px; background-color: #e74c3c; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        .modal-title { font-size: 1.2rem; margin: 15px 0 5px 0; }
        .label { font-weight: bold; font-size: 0.8rem; color: #666; }
        .spec-text { white-space: pre-wrap; font-size: 0.9rem; color: #333; margin-top: 5px; }
        .status-badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 10px; color: white; font-weight: bold; background: #6c757d; }
    </style>
</head>
<body>

    <div class="header-area">
        <h1>Basics of Scaffolding</h1>
        <div class="author">by Gurwinder Singh</div>
    </div>

    <div class="controls-container">
        <input type="text" id="searchInput" placeholder="Search name or ID..." onkeyup="handleFilters()">
        <div id="categoryTabs" class="category-scroll"></div>
    </div>

    <div id="gallery" class="gallery"></div>

    <div id="modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" id="swipeArea">
            <div class="item-counter" id="m-counter"></div>
            <span class="close-btn-top" onclick="doClose()">&times;</span>
            
            <button class="nav-btn nav-prev" onclick="navItem(-1)">❮</button>
            <button class="nav-btn nav-next" onclick="navItem(1)">❯</button>

            <div class="modal-body-scroll" id="modalBody">
                <div id="media-viewer" class="media-container"></div>
                <h2 id="m-title" class="modal-title"></h2>
                <span id="m-status" class="status-badge"></span>
                <p><span class="label">ID Reference:</span> <span id="m-id"></span></p>
                <hr>
                <span class="label">Specifications:</span>
                <div id="m-specs" class="spec-text"></div>
                <button class="btn-close-bottom" onclick="doClose()">Close Details</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxE_L-8c2RjUsE8DHSEBItLvzlQQ6nE1uxquecQAAgD0uPvWbZbeKieIzkV8Yg3nuEO/exec'; 
        let allItems = [];
        let filteredItems = [];
        let currentIndex = -1;
        let activeCategory = 'All';

        // SWIPE LOGIC VARIABLES
        let touchstartX = 0;
        let touchendX = 0;

        async function loadApp() {
            try {
                const res = await fetch(API_URL);
                allItems = await res.json();
                filteredItems = allItems;
                createCategoryTabs();
                render(filteredItems);
                setupSwipe();
            } catch(e) { console.error("Load failed", e); }
        }

        function createCategoryTabs() {
            const tabsContainer = document.getElementById('categoryTabs');
            const categories = ['All', ...new Set(allItems.map(item => item.Category).filter(Boolean))];
            tabsContainer.innerHTML = '';
            categories.forEach(cat => {
                const tab = document.createElement('div');
                tab.className = `cat-tab ${cat === activeCategory ? 'active' : ''}`;
                tab.innerText = cat;
                tab.onclick = () => {
                    activeCategory = cat;
                    document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    handleFilters();
                };
                tabsContainer.appendChild(tab);
            });
        }

        function handleFilters() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            filteredItems = allItems.filter(item => {
                const matchesSearch = (item.Title?.toLowerCase().includes(query)) || (item.ID?.toString().toLowerCase().includes(query));
                const matchesCategory = (activeCategory === 'All' || item.Category === activeCategory);
                return matchesSearch && matchesCategory;
            });
            render(filteredItems);
        }

        function render(items) {
            const container = document.getElementById('gallery');
            container.innerHTML = ''; 
            items.forEach((item, index) => {
                const url = item['Image URL'] || '';
                const isVid = isVideo(url);
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => openModal(index);
                card.innerHTML = `
                    <div class="thumb-container">
                        ${isVid ? '<div class="video-indicator">▶</div>' : ''}
                        <img src="${isVid ? 'https://via.placeholder.com/150/000/fff?text=VIDEO' : url}">
                    </div>
                    <div class="card-title">${item.Title}</div>
                `;
                container.appendChild(card);
            });
        }

        function isVideo(url) {
            if(!url) return false;
            return url.includes('youtube.com') || url.includes('youtu.be') || url.match(/\.(mp4|webm|ogg)$/i);
        }

        function openModal(index) {
            currentIndex = index;
            const item = filteredItems[currentIndex];
            const viewer = document.getElementById('media-viewer');
            const url = item['Image URL'] || '';

            const body = document.getElementById('modalBody');
            body.classList.remove('slide-effect');
            void body.offsetWidth;
            body.classList.add('slide-effect');

            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                let vidId = url.split('v=')[1] || url.split('/').pop();
                viewer.innerHTML = `<iframe id="vidPlayer" src="https://www.youtube.com/embed/${vidId}?autoplay=1" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
            } else if (url.match(/\.(mp4|webm|ogg)$/i)) {
                viewer.innerHTML = `<video id="vidPlayer" controls autoplay><source src="${url}" type="video/mp4"></video>`;
            } else {
                viewer.innerHTML = `<img src="${url}" alt="Equipment">`;
            }

            document.getElementById('m-counter').innerText = `${currentIndex + 1} of ${filteredItems.length}`;
            document.getElementById('m-title').innerText = item.Title || '';
            document.getElementById('m-id').innerText = item.ID || '';
            document.getElementById('m-status').innerText = item.Status || '';
            document.getElementById('m-specs').innerText = item.Specs || '';
            document.getElementById('modal').style.display = 'flex';
            body.scrollTop = 0;
        }

        function navItem(step) {
            let newIndex = currentIndex + step;
            if (newIndex >= 0 && newIndex < filteredItems.length) openModal(newIndex);
        }

        // SWIPE FUNCTIONALITY
        function setupSwipe() {
            const swipeArea = document.getElementById('swipeArea');
            swipeArea.addEventListener('touchstart', e => { touchstartX = e.changedTouches[0].screenX; }, false);
            swipeArea.addEventListener('touchend', e => { 
                touchendX = e.changedTouches[0].screenX;
                handleGesture();
            }, false);
        }

        function handleGesture() {
            if (touchendX < touchstartX - 50) navItem(1); // Swipe Left -> Next
            if (touchendX > touchstartX + 50) navItem(-1); // Swipe Right -> Prev
        }

        function doClose() {
            document.getElementById('media-viewer').innerHTML = ''; 
            document.getElementById('modal').style.display = 'none';
        }

        function closeModal(e) { if(e.target.id === 'modal') doClose(); }

        loadApp();
    </script>
</body>
</html>
